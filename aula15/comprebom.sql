-- INIT database
-- criação das tabelas 
CREATE TABLE CCUSTO (
  CCusto VARCHAR(3) NOT NULL,
  NomeCC VARCHAR(10) NOT NULL,
  
  CONSTRAINT PK_CCUSTO PRIMARY KEY(CCusto)
);

CREATE TABLE SECAO (
  Secao NUMERIC(3) NOT NULL,
  NomeSec VARCHAR(20) NOT NULL,
  CCusto VARCHAR(3) NOT NULL,
  
  CONSTRAINT PK_SECAO PRIMARY KEY(Secao),
  CONSTRAINT FK_SECAO_CCUSTO FOREIGN KEY(CCusto) REFERENCES CCUSTO(CCusto)
);

CREATE TABLE ALMOXARIFE (
  NAlmox NUMERIC(4) NOT NULL,
  Almoxarife VARCHAR(30) NOT NULL,
  
  CONSTRAINT PK_ALMOXARIFE PRIMARY KEY(NAlmox)
);

CREATE TABLE REQUISICAO (
  NumReq NUMERIC(7) NOT NULL,
  DtReq DATETIME(10) NOT NULL,
  Secao NUMERIC(3) NOT NULL,
  NAlmox NUMERIC(4) NOT NULL,
  
  CONSTRAINT PK_REQUISICAO PRIMARY KEY(NumReq),
  CONSTRAINT FK_REQUISCAO_SECAO FOREIGN KEY(Secao) REFERENCES SECAO(Secao),
  CONSTRAINT FK_REQUISICAO_ALMOXARIFE FOREIGN KEY(NAlmox) REFERENCES ALMOXARIFE(NAlmox)
);

CREATE TABLE MATERIAL (
  CdMat NUMERIC(4) NOT NULL,
  DescrMatPrima VARCHAR(15) NOT NULL,
  
  CONSTRAINT PK_MATERIAL PRIMARY KEY(CdMat)
);

CREATE TABLE REQ_MAT (
  NumReq NUMERIC(7) NOT NULL,
  CdMat NUMERIC(4) NOT NULL,
  QtdReq NUMERIC(7) NOT NULL,
  VlrUnit DECIMAL(10,2) NOT NULL,
  
  CONSTRAINT PK_REQ_MAT PRIMARY KEY(NumReq, CdMat), 
  CONSTRAINT FK_REQ_MAT_REQUISICAO FOREIGN KEY(NumReq) REFERENCES REQUISICAO(NumReq),
  CONSTRAINT FK_REQ_MAT_MATERIAL FOREIGN KEY(CdMat) REFERENCES MATERIAL(CdMat)
);

--- Questão 01 - inserindo os dados nas tabelas


INSERT INTO CCUSTO(CCusto, NomeCC)
VALUES('10A', 'SUB-1'),
('10B', 'Mult-2'),
('11A', 'SUB-2'),
('12A', 'SUB-3');

INSERT INTO SECAO(Secao, NomeSec, CCusto)
VALUES(020, 'Manutencao', '10A'),
(021, 'Producao-1', '10A'),
(022, 'Reparos', '10B'),
(025, 'Escritorio', '10B'),
(023, 'Producao-2', '11A'),
(024, 'Producao-3', '11A'),
(010, 'ADM', '12A');

INSERT INTO ALMOXARIFE(NAlmox, Almoxarife)
VALUES(1001, 'Joao da Silva'),
(1002, 'Antonio Prado'),
(1006, 'Antonio Sanos'),
(1003, 'Loureco Dias'),
(1008, 'Sergio Melo'),
(1004, 'Joao Antonio'),
(1005, 'Silvino Torres'),
(1007, 'Valter Souza');

INSERT INTO REQUISICAO(NumReq, DtReq, Secao, NAlmox)
VALUES (101, 20020601, 020, 1001),
(106, 20020602, 020, 1002),
(102, 20020601, 021, 1001),
(109, 20020604, 021, 1006),
(103, 20020601, 022, 1003),
(107, 20020603, 025, 1008),
(108, 20020603, 025, 1001),
(104, 20020602, 023, 1004),
(105, 20020602, 024, 1005),
(110, 20020604, 010, 1006),
(111, 20020604, 101, 1007);

INSERT INTO MATERIAL(CdMat, DescrMatPrima)
VALUES (100, 'Enxofre'),
(101, 'Areia Monaztica'),
(102, 'Argila Moida');

INSERT INTO REQ_MAT(NumReq, CdMat, QtdReq, VlrUnit)
VALUES (101, 100, 8, 12.50),
(101, 101, 5, 10.00),
(106, 100, 15, 15.00);

SELECT * FROM CCUSTO;
SELECT * FROM SECAO;
SELECT * FROM ALMOXARIFE;
SELECT * FROM REQUISICAO;
SELECT * FROM MATERIAL;
SELECT * FROM REQ_MAT;

--- Questão 02

INSERT INTO CCUSTO(CCusto, NomeCC)
VALUES('25L', 'LET-25');

INSERT INTO SECAO(Secao, NomeSec, CCusto)
VALUES(050, 'Decoracao', '25L');

INSERT INTO ALMOXARIFE(NAlmox, Almoxarife)
VALUES(9999, 'John Lennon');

INSERT INTO MATERIAL(CdMat, DescrMatPrima)
VALUES (999, 'Tinta');

--- Questão 03

UPDATE SECAO
SET NomeSec = 'Seção Teste 001'
WHERE Secao = 050

UPDATE SECAO
SET CCusto = '11A'
WHERE CCusto = '25L'

--- Questao 04

DELETE FROM CCUSTO WHERE CCusto =  '10C'

--- Questao 05

ALTER TABLE MATERIAL 
ADD COLUMN VlrUnit DECIMAL(10,2);

INSERT INTO MATERIAL(CdMat, DescrMatPrima, VlrUnit)
VALUES (890, 'Pincel', 20.70);

SELECT * FROM MATERIAL;

--- Questao 06

ALTER TABLE MATERIAL 
DROP COLUMN VlrUnit DECIMAL(10,2) NOT NULL;

--- Questao 07

SELECT Almoxarife FROM ALMOXARIFE 
WHERE Almoxarife LIKE 'Joao%';

--- Questao 08

SELECT DISTINCT Secao, DtReq FROM REQUISICAO;

--- Questao 09

SELECT CCusto, NomeCC FROM CCUSTO 
WHERE CCusto = '10B' OR CCusto = '12A';

--- Questao 10

SELECT * FROM REQUISICAO 
WHERE Secao = 020 AND DtReq <= 20200602;

--- Questao 11

SELECT * FROM REQUISICAO
WHERE DtReq >= 20020603
ORDER BY DtReq
LIMIT 3;

--- Questao 12

SELECT Secao FROM SECAO
WHERE Secao % 2 != 0;
